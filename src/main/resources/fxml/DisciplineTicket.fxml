<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.teacher.ui.controller.DisciplineTicketController"
            styleClass="content-pane">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Top: Title -->
    <top>
        <VBox spacing="5">
            <padding>
                <Insets bottom="15"/>
            </padding>
            <Label text="Submit Discipline Referral" styleClass="page-title"
                   style="-fx-font-size: 24px; -fx-font-weight: bold;"/>
            <Label text="Select a template below, choose a student, and submit a behavior incident report."
                   styleClass="text-secondary"/>
        </VBox>
    </top>

    <!-- Left: Student search panel -->
    <left>
        <VBox spacing="10" prefWidth="280" style="-fx-padding: 0 15 0 0;">
            <Label text="Select Student" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

            <Label text="Filter by Period" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
            <ComboBox fx:id="periodFilterCombo" maxWidth="Infinity" promptText="All Students"/>

            <TextField fx:id="studentSearchField" promptText="Search by name or ID..."
                       styleClass="search-field"/>

            <ListView fx:id="studentListView" VBox.vgrow="ALWAYS" prefHeight="200"/>

            <!-- Selected Student Card -->
            <VBox fx:id="selectedStudentCard" spacing="5" styleClass="card"
                  style="-fx-padding: 10; -fx-background-radius: 8;" visible="false" managed="false">
                <Label text="Selected Student" styleClass="text-secondary" style="-fx-font-size: 10px;"/>
                <Label fx:id="selectedStudentName" text="" style="-fx-font-weight: bold; -fx-font-size: 14px;"/>
                <Label fx:id="selectedStudentGrade" text="" styleClass="text-secondary"/>
                <Label fx:id="selectedStudentId" text="" styleClass="text-secondary" style="-fx-font-size: 10px;"/>
            </VBox>
        </VBox>
    </left>

    <!-- Center: Main form -->
    <center>
        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
            <VBox spacing="15" style="-fx-padding: 0 0 20 0;">

                <!-- Template Quick-Pick Grid -->
                <VBox spacing="8">
                    <Label text="Quick-Pick Template" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                    <Label text="Click a template to pre-fill the form with proper legal language."
                           styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                    <FlowPane fx:id="templateGrid" hgap="8" vgap="8" prefWrapLength="600"/>
                </VBox>

                <Separator/>

                <!-- Form Fields -->
                <VBox spacing="12">
                    <Label text="Incident Details" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                    <!-- Row 1: Behavior Type + Category -->
                    <HBox spacing="15">
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label text="Behavior Type" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                            <ComboBox fx:id="behaviorTypeCombo" maxWidth="Infinity" promptText="Select type"/>
                        </VBox>
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label text="Category" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                            <ComboBox fx:id="categoryCombo" maxWidth="Infinity" promptText="Select category"/>
                        </VBox>
                    </HBox>

                    <!-- Row 2: Severity + Location -->
                    <HBox spacing="15">
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label text="Severity" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                            <ComboBox fx:id="severityCombo" maxWidth="Infinity" promptText="Select severity"/>
                        </VBox>
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label text="Location" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                            <ComboBox fx:id="locationCombo" maxWidth="Infinity" promptText="Select location"/>
                        </VBox>
                    </HBox>

                    <!-- Row 3: Date + Time (auto-filled) -->
                    <HBox spacing="15">
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label text="Incident Date" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                            <DatePicker fx:id="incidentDatePicker" maxWidth="Infinity"/>
                        </VBox>
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label text="Incident Time" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                            <TextField fx:id="incidentTimeField" promptText="HH:mm" maxWidth="Infinity"/>
                        </VBox>
                    </HBox>

                    <!-- Description -->
                    <VBox spacing="4">
                        <Label text="Incident Description" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                        <TextArea fx:id="descriptionArea" promptText="Describe the incident..."
                                  prefRowCount="6" wrapText="true"/>
                        <Label fx:id="placeholderHint" text="" styleClass="text-secondary"
                               style="-fx-font-size: 10px; -fx-text-fill: #F59E0B;" visible="false" managed="false"/>
                    </VBox>

                    <!-- Intervention Applied -->
                    <VBox spacing="4">
                        <Label text="Intervention Applied" styleClass="text-secondary" style="-fx-font-size: 11px;"/>
                        <TextArea fx:id="interventionArea" promptText="Describe intervention steps taken..."
                                  prefRowCount="3" wrapText="true"/>
                    </VBox>

                    <!-- Checkboxes -->
                    <HBox spacing="20">
                        <CheckBox fx:id="parentContactedCb" text="Parent Contacted"/>
                        <CheckBox fx:id="adminReferralCb" text="Admin Referral Required"/>
                    </HBox>

                    <!-- Submit -->
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Button fx:id="submitBtn" text="Submit Incident" onAction="#handleSubmit"
                                styleClass="button-primary" prefHeight="40" prefWidth="180"/>
                        <Button text="Clear Form" onAction="#handleClearForm"
                                styleClass="button-secondary" prefHeight="40"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="feedbackLabel" text="" style="-fx-font-size: 12px;"/>
                    </HBox>
                </VBox>

                <Separator/>

                <!-- Recent Submissions -->
                <VBox spacing="8">
                    <Label text="Recent Submissions (This Session)" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                    <TableView fx:id="recentSubmissionsTable" prefHeight="150">
                        <columns>
                            <TableColumn fx:id="recentTimeCol" text="Time" prefWidth="80"/>
                            <TableColumn fx:id="recentStudentCol" text="Student" prefWidth="150"/>
                            <TableColumn fx:id="recentCategoryCol" text="Category" prefWidth="130"/>
                            <TableColumn fx:id="recentSeverityCol" text="Severity" prefWidth="90"/>
                            <TableColumn fx:id="recentStatusCol" text="Status" prefWidth="100"/>
                        </columns>
                    </TableView>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>
